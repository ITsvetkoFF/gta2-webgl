<html>
<head>
<title>Gta2 web port</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style>
    body {
        font-family: Monospace;
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
    }
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/jdataview.js" type="application/javascript" language="javascript">
</script>
<script src="/mapParser.js" type="application/javascript" language="javascript">
</script>
<script src="/styleParser.js" type="application/javascript" language="javascript">
</script>

<script>

function getXHR(){
    var xhr;
    try{
        xhr = new XMLHttpRequest();
    }catch(e){
        try{
            xhr = new ActiveXObject("MSXML2.XMLHTTP.6.0");
        }catch(e2){
            try{
                xhr = new ActiveXObject("MSXML2.XMLHTTP");
            }catch(e3){}
        }
    }
    return xhr;
}

function getBinaryData(url, callback){
    var xhr = getXHR();
    xhr.open("GET", url, !!callback);
    if(callback){
        xhr.onload = function(){callback(xhr, true)};
        xhr.onerror = function(){callback(xhr, false)};
    }
    xhr.send();
    return callback ? undefined : xhr.responseText;
}

</script>

</head>

<body>
<script>
	$(function () {
		var level;
		$("#statusmessage").text("Downloading map...");
		getBinaryData("http://localhost:8000/MP1-comp.gmp", LoadComplete);
		
		function LoadComplete(data, err)
		{
			$("#statusmessage").text("Parsing map...");
			var mapData = data.responseText;
			level = new ReadFromData(mapData);
			$("#statusmessage").text("Downloading styles...");
			getBinaryData("http://localhost:8000/wil.sty", function (data, err) {
				$("#statusmessage").text("Parsing styles...");
				console.log("parsing");
					var styleData = data.responseText;
					style = ParseStyle(styleData);
					$("#statusmessage").text("Initalizing game...");
					debugger;
					init();
					$("#statusmessage").hide();
					animate();
				}
			);
		}
	});
	
</script>

<div id="statusmessage" style="position: absolute; top: 10%; width: 100%; text-align: center;"></div>

<script src="/three/build/three.min.js"></script>

<script src="/three/examples/js/libs/stats.min.js"></script>

<script src="/render.js"></script>

</body>

</html>